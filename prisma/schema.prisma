// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-py"
  interface = "asyncio"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://user:password@localhost:5432/db"
}

model User {
  id  String  @id @default(uuid())
  sub String  @unique
  name String
  email String? @unique
  picture String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  locale String?
  emailVerified Boolean? @default(false)
  givenName String?
  familyName String?
  nickname String?
  ownIpAddresses IPAddress[] @relation("user_ips")
  ips IPAddress[] @relation("collected_ips")
}

model IPAddress {
  user User? @relation("user_ips",fields: [userId], references: [id]) 
  userId String? @unique
  collectedBy User[] @relation("collected_ips")
  host String
  domain String?
  ip String  @unique @id
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  geoIP GeoIP?
  network Network?
  scan Scan?
  app App?
} 
  // GeoIP

model GeoIP {
  id String @unique @id @default(uuid())
  ip String @unique
  ipAddr IPAddress @relation(fields: [ip], references: [ip])
  city String?
  region String?
  country String?
  postal String?
  latitude Float?
  longitude Float?
  timezone String?
  asn String?
  org String?
  isp String?
  mobile Boolean?
  proxy Boolean?
}
  // Network
model Network {
  id String @unique @id @default(uuid())
  ip String @unique
  ipAddr IPAddress @relation(fields: [ip], references: [ip])
  cidr String?
  network String?
  mask String?
  type String?
}
  // Scanner
model Scan {
  id String @unique @id @default(uuid())
  ip String @unique
  ipAddr IPAddress @relation(fields: [ip], references: [ip])  
  openPorts String?
  openServices String?
  openProtocols String?
  os String?
  osVersion String?
  osCpe String?
}
  // Application
model App {
  id String @unique @id @default(uuid())
  ip String @unique
  ipAddr IPAddress @relation(fields: [ip], references: [ip])
  links String[]
  headers String[]
  html String?
  scripts String[]
  images String[]
  styles String[]
} 